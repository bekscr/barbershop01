<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Barbershop 01 — Онлайн-запись</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111111">
<style>
  :root{
    --bg:#0f0f10;--card:#151618;--text:#f3f5f7;--muted:#98a0a8;
    --accent:#e6b300;--border:#242629;--chip:#1e2024;--ok:#0cc267;
    --radius:16px;
  }
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,Inter,Roboto,Arial}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:820px;margin:0 auto;min-height:100dvh;position:relative}
  /* HERO */
  .hero{position:relative; height:200px; background:
    linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,.85)),
    url('https://images.unsplash.com/photo-1517832606299-7ae9b720a186?q=80&w=1200&auto=format&fit=crop') center/cover no-repeat;}
  .hero-inner{display:flex;align-items:flex-end;gap:14px;height:100%;padding:18px}
  .logo{width:56px;height:56px;border-radius:50%;display:grid;place-items:center;
    background:#000;border:2px solid #fff;color:#fff;font-weight:900;font-size:22px}
  .hero h1{margin:0;font-size:20px}
  .hero .sub{color:var(--muted);font-size:13px}
  .badge{display:inline-block;margin-top:6px;padding:6px 10px;border-radius:999px;background:#101112;border:1px solid var(--border);font-size:12px}
  /* NAV pills */
  .tabs{display:flex;gap:8px;overflow:auto;padding:10px 12px;background:#0c0c0d;border-bottom:1px solid var(--border)}
  .tab{padding:10px 12px;border-radius:999px;background:#121315;border:1px solid var(--border);white-space:nowrap}
  .tab.active{background:var(--accent);color:#111;font-weight:800;border-color:var(--accent)}
  /* Sections */
  .section{padding:16px}
  .list{display:flex;flex-direction:column;gap:12px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:14px}
  .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .btn{width:100%;padding:16px;border-radius:14px;border:0;background:#111;color:#fff;font-weight:800;font-size:16px}
  .btn-accent{background:var(--accent);color:#111}
  .muted{color:var(--muted)}
  /* Services */
  .svc{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .svc .info{line-height:1.25}
  .svc .meta{font-size:12px;color:var(--muted)}
  .check{appearance:none;width:22px;height:22px;border:2px solid #404349;border-radius:6px;display:grid;place-items:center;background:#121315}
  .check:checked{background:var(--ok);border-color:var(--ok)}
  .check:checked::after{content:"✓";color:#fff;font-size:14px}
  .chipbar{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .chip{padding:8px 10px;border-radius:999px;background:var(--chip);border:1px solid var(--border);cursor:pointer}
  .chip.sel{background:#fff;color:#111;border-color:#fff}
  /* Masters */
  .master{display:flex;gap:12px}
  .ava{width:50px;height:50px;border-radius:50%;background:linear-gradient(#282a2f,#1b1d22);
    display:grid;place-items:center;font-weight:900}
  .radio{width:22px;height:22px;border-radius:50%;border:2px solid #60646a;display:grid;place-items:center}
  .radio span{width:10px;height:10px;border-radius:50%;background:#fff;transform:scale(0);transition:.15s}
  .radio.act span{transform:scale(1)}
  /* Calendar */
  .cal{overflow:hidden}
  .cal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
  .dow,.d{height:42px;display:grid;place-items:center;border-radius:10px}
  .dow{font-size:12px;color:var(--muted)}
  .d{background:#121315;border:1px solid var(--border)}
  .d.sel{background:#fff;color:#111;border-color:#fff}
  /* sticky bar */
  .cta{position:sticky;bottom:0;background:linear-gradient(180deg,transparent,rgba(0,0,0,.6) 20%,rgba(0,0,0,.9));
    padding:14px}
  /* contacts */
  .actions{display:flex;gap:8px}
  .action{flex:1;padding:14px;border-radius:12px;border:1px solid var(--border);background:#121315;text-align:center}
  .action strong{display:block}
  iframe{width:100%;height:240px;border:0;border-radius:12px}
</style>
</head>
<body>
<div class="wrap">

  <!-- HERO -->
  <div class="hero">
    <div class="hero-inner">
      <div class="logo">01</div>
      <div>
        <h1>Barbershop 01</h1>
        <div class="sub">Бишкек, ул. Уметалиева 89</div>
        <div class="badge">Режим работы: <b>10:00–21:00</b></div>
      </div>
    </div>
  </div>

  <!-- Top pills -->
  <div class="tabs">
    <a class="tab active" id="tab-services" href="#services">Услуги</a>
    <a class="tab" id="tab-masters" href="#masters">Специалисты</a>
    <a class="tab" id="tab-calendar" href="#calendar">Дата и время</a>
    <a class="tab" id="tab-checkout" href="#checkout">Подтверждение</a>
    <a class="tab" id="tab-contacts" href="#contacts">Контакты</a>
  </div>

  <!-- SERVICES -->
  <section id="services" class="section">
    <div class="card"><div class="muted">Выберите услуги. Если выберете старшего мастера Бектура — цены пересчитаются автоматически.</div></div>

    <div class="card">
      <div class="muted" style="margin-bottom:8px">Основные услуги</div>
      <div id="svc-basic" class="list"></div>
    </div>

    <div class="card">
      <div class="muted" style="margin-bottom:8px">Дополнительные услуги</div>
      <div id="svc-extra" class="list"></div>
    </div>

    <div class="card">
      <div class="muted" style="margin-bottom:8px">Старший мастер / Топ-барбер (для Бектура)</div>
      <div id="svc-senior" class="list"></div>
    </div>
  </section>

  <!-- MASTERS -->
  <section id="masters" class="section" style="display:none">
    <div id="mastersList" class="list"></div>
  </section>

  <!-- CALENDAR -->
  <section id="calendar" class="section" style="display:none">
    <div class="card cal">
      <div class="cal-head">
        <button onclick="shiftMonth(-1)" class="tab">‹</button>
        <div id="monthLabel" style="font-weight:800"></div>
        <button onclick="shiftMonth(1)" class="tab">›</button>
      </div>
      <div class="cal-grid" id="calHead"></div>
      <div class="cal-grid" id="calGrid"></div>
    </div>
    <div class="card" style="margin-top:12px">
      <div class="muted">Свободное время</div>
      <div class="chipbar" id="daySlots"></div>
    </div>
  </section>

  <!-- CHECKOUT -->
  <section id="checkout" class="section" style="display:none">
    <div class="card">
      <div style="font-weight:800;margin-bottom:6px">Ваш выбор</div>
      <div id="summary" class="muted"></div>
    </div>
    <div class="card" style="margin-top:12px">
      <div class="list">
        <input class="tab" style="padding:14px;border-radius:10px;border:1px solid var(--border);background:#121315;color:#fff" id="name" placeholder="Ваше имя">
        <input class="tab" style="padding:14px;border-radius:10px;border:1px solid var(--border);background:#121315;color:#fff" id="phone" placeholder="+996 ___ ___ ___" inputmode="tel">
        <div class="muted">Подтверждение откроется в WhatsApp на номер салона.</div>
      </div>
    </div>
  </section>

  <!-- CONTACTS -->
  <section id="contacts" class="section" style="display:none">
    <div class="card">
      <div style="font-weight:800;margin-bottom:10px">Как нас найти</div>
      <div class="actions" style="margin-bottom:12px">
        <a class="action" href="tel:+996509951599"><strong>Позвонить</strong> +996 509 951 599</a>
        <a class="action" href="https://wa.me/996509951599" target="_blank"><strong>WhatsApp</strong> чат с админом</a>
      </div>
      <div class="actions" style="margin-bottom:12px">
        <a class="action" href="https://2gis.kg/bishkek" target="_blank"><strong>2ГИС</strong> открыть карту</a>
        <a class="action" href="https://yandex.ru/maps/?text=Бишкек%2C%20Уметалиева%2089" target="_blank"><strong>Яндекс.Карты</strong> маршрут</a>
      </div>
      <!-- Встраиваемая карта (без ключа) -->
      <iframe
        src="https://maps.google.com/maps?q=Бишкек%2C%20Уметалиева%2089&t=&z=15&ie=UTF8&iwloc=&output=embed"
        loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
  </section>

  <!-- CTA -->
  <div class="cta"><button class="btn btn-accent" onclick="primaryAction()" id="primaryBtn">Продолжить</button></div>
</div>

<script>
/* ====== ДАННЫЕ ====== */
const salon = { phone:'+996509951599', address:'Бишкек, ул. Уметалиева 89', hours:'10:00–21:00' };

const masters = [
  {id:'m_bektur',  name:'Бектур',  role:'Старший мастер', exp:'7 лет стажа',  senior:true,  slots:['10:00','10:30','11:30','12:30','14:00','16:00','18:00','20:00']},
  {id:'m_bolot',   name:'Болот',   role:'Барбер',         exp:'3 года стажа', senior:false, slots:['10:00','11:00','12:00','13:00','15:00','17:00','19:00']},
  {id:'m_kaabay',  name:'Каабай',  role:'Барбер',         exp:'2 года стажа', senior:false, slots:['10:30','11:30','12:30','14:30','16:30','18:30']},
  {id:'m_kubanych',name:'Кубаныч', role:'Барбер',         exp:'2 года стажа', senior:false, slots:['10:00','11:00','12:00','15:00','17:30','19:30']},
  {id:'m_adilet',  name:'Адилет',  role:'Барбер',         exp:'15 лет стаж',  senior:false, slots:['10:00','12:00','14:00','16:00','18:00','20:30']},
  {id:'m_elnura',  name:'Элнура',  role:'Барбер',         exp:'6 лет стажа',  senior:false, slots:['11:00','12:00','13:30','15:30','17:30','19:30']},
];

const basic = [
  {id:'b_man',  name:'Мужская',                 price:500, dur:40},
  {id:'b_kid',  name:'Детская',                 price:500, dur:40},
  {id:'b_beard',name:'Оформление бороды',       price:400, dur:30},
  {id:'b_corr', name:'Коррекция бороды/волос',  price:200, dur:15},
  {id:'b_style',name:'Укладка',                 price:200, dur:15},
  {id:'b_bald', name:'Под машинку / налысо',    price:100, dur:10},
];

const extra = [
  {id:'e_mask', name:'Чистка лица / Черная маска', price:350, dur:40},
  {id:'e_scrub',name:'Чистка лица / Скраб',        price:350, dur:20},
  {id:'e_wax',  name:'Горячий воск',               price:100, dur:10},
  {id:'e_grey', name:'Тонировка седины',           price:400, dur:30},
  {id:'e_cam',  name:'Камуфляж бороды',            price:500, dur:30},
  {id:'e_perm', name:'Хим завивка со стрижкой (недоступно)', price:2500, dur:90, disabled:true},
];

const senior = [
  {id:'s_man',  name:'Мужская (старший)',                price:700, dur:40},
  {id:'s_kid',  name:'Детская (старший)',                price:700, dur:40},
  {id:'s_beard',name:'Оформление бороды (старший)',      price:600, dur:30},
  {id:'s_corr', name:'Коррекция бороды/волос (старший)', price:400, dur:15},
  {id:'s_style',name:'Укладка (старший)',                price:400, dur:15},
  {id:'s_bald', name:'Под машинку / налысо (старший)',   price:200, dur:10},
  {id:'s_clean',name:'Чистка лица (старший)',            price:800, dur:40},
  {id:'s_mask', name:'Черная маска (старший)',           price:400, dur:20},
  {id:'s_scrub',name:'Скраб (старший)',                  price:400, dur:20},
  {id:'s_tone', name:'Тонировка (старший)',              price:500, dur:30},
];

/* ====== СОСТОЯНИЕ ====== */
const state = { services:new Set(), master:null, date:null, time:null };

/* ====== UI HELPER ====== */
const sections = ['services','masters','calendar','checkout','contacts'];
function showSection(id){
  sections.forEach(s=>document.getElementById(s).style.display = (s===id)?'block':'none');
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active', t.getAttribute('href')==='#'+id));
  document.getElementById('primaryBtn').textContent = (id==='checkout')?'Подтвердить запись':'Продолжить';
  if(id==='checkout') updateSummary();
}
document.querySelectorAll('.tabs a').forEach(a=>a.addEventListener('click',e=>{e.preventDefault(); showSection(a.getAttribute('href').slice(1));}));

/* ====== РЕНДЕР УСЛУГ ====== */
function renderServiceList(container, list){
  container.innerHTML='';
  list.forEach(s=>{
    const row = document.createElement('div'); row.className='svc';
    row.innerHTML = `<div class="info"><div style="font-weight:700">${s.name}</div><div class="meta">${s.dur} мин • ${s.price} сом</div></div>`;
    const ch = document.createElement('input'); ch.type='checkbox'; ch.className='check'; ch.disabled=!!s.disabled;
    ch.checked = state.services.has(s.id);
    ch.onchange = ()=>{ ch.checked?state.services.add(s.id):state.services.delete(s.id); };
    row.appendChild(ch); container.appendChild(row);
  });
}
function renderServices(){
  renderServiceList(document.getElementById('svc-basic'), basic);
  renderServiceList(document.getElementById('svc-extra'), extra);
  renderServiceList(document.getElementById('svc-senior'), senior);
}

/* ====== РЕНДЕР МАСТЕРОВ + фильтр по услуге «Хим завивка» ====== */
function renderMasters(){
  const box=document.getElementById('mastersList'); box.innerHTML='';
  masters.forEach(m=>{
    const card=document.createElement('div'); card.className='card';
    card.innerHTML = `
      <div class="row">
        <div class="master">
          <div class="ava">${m.name[0]}</div>
          <div>
            <div style="font-weight:800">${m.role} ${m.name}</div>
            <div class="muted">${m.exp}</div>
            <div class="chipbar" style="margin-top:8px">${m.slots.map(t=>`<span class="chip" data-mid="${m.id}" data-t="${t}">${t}</span>`).join('')}</div>
          </div>
        </div>
        <label class="radio ${state.master===m.id?'act':''}" data-radio="${m.id}"><span></span></label>
      </div>`;
    box.appendChild(card);
  });
  box.querySelectorAll('[data-radio]').forEach(r=>r.onclick=()=>{state.master=r.dataset.radio; state.time=null; renderMasters();});
  box.querySelectorAll('.chip').forEach(ch=>{
    if(state.master===ch.dataset.mid && state.time===ch.dataset.t) ch.classList.add('sel');
    ch.onclick=()=>{ state.master=ch.dataset.mid; state.time=ch.dataset.t; renderMasters(); };
  });
}

/* ====== КАЛЕНДАРЬ 10:00–21:00 ====== */
const calHead=document.getElementById('calHead');
'Пн Вт Ср Чт Пт Сб Вс'.split(' ').forEach(d=>{const el=document.createElement('div'); el.className='dow'; el.textContent=d; calHead.appendChild(el);});
const calGrid=document.getElementById('calGrid'); const monthLabel=document.getElementById('monthLabel');
const months='Январь Февраль Март Апрель Май Июнь Июль Август Сентябрь Октябрь Ноябрь Декабрь'.split(' ');
let cur=new Date(); cur.setDate(1);
function renderCal(){
  calGrid.innerHTML=''; monthLabel.textContent=months[cur.getMonth()]+' '+cur.getFullYear();
  const start=(cur.getDay()+6)%7, days=new Date(cur.getFullYear(),cur.getMonth()+1,0).getDate();
  for(let i=0;i<start;i++){const el=document.createElement('div'); el.className='d'; el.style.visibility='hidden'; calGrid.appendChild(el);}
  for(let d=1; d<=days; d++){
    const el=document.createElement('div'); el.className='d'; el.textContent=d;
    const ds = `${cur.getFullYear()}-${String(cur.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    if(state.date===ds) el.classList.add('sel');
    el.onclick=()=>{state.date=ds; state.time=null; renderCal(); renderDaySlots();};
    calGrid.appendChild(el);
  }
}
function shiftMonth(delta){cur.setMonth(cur.getMonth()+delta); renderCal(); renderDaySlots();}
function renderDaySlots(){
  const box=document.getElementById('daySlots'); box.innerHTML='';
  if(!state.date){ box.innerHTML='<span class="muted">Выберите дату</span>'; return; }
  const slots=[]; let h=10,m=0; while(h<21 || (h===21&&m===0)){ slots.push(`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`); m+=30; if(m>=60){m=0;h++;} }
  slots.forEach(t=>{
    const el=document.createElement('span'); el.className='chip'; el.textContent=t;
    if(state.time===t) el.classList.add('sel');
    el.onclick=()=>{state.time=t; renderDaySlots();}; box.appendChild(el);
  });
}

/* ====== ИТОГО / КНОПКА ====== */
function money(v){return new Intl.NumberFormat('ru-RU').format(v)}
function updateSummary(){
  const chosenIds=Array.from(state.services);
  const all=[...basic,...extra,...senior];
  const chosen = chosenIds.map(id=>all.find(s=>s.id===id)).filter(Boolean);
  const sum = chosen.reduce((a,b)=>a+b.price,0);
  const dur = chosen.reduce((a,b)=>a+(b.dur||0),0);
  const m = masters.find(x=>x.id===state.master);
  document.getElementById('summary').innerHTML =
    `Услуги: ${chosen.map(s=>s.name).join(', ')||'—'} • <b>${money(sum)} сом</b> • ${dur} мин. `
    + `Мастер: <b>${m? (m.senior?'Старший ':'')+m.name : 'любой'}</b>. `
    + `Дата: <b>${state.date||'—'}</b> ${state.time||''}`;
}
function primaryAction(){
  const visible = sections.find(id=>document.getElementById(id).style.display!=='none');
  if(visible==='checkout'){
    const name=document.getElementById('name').value.trim();
    const phone=document.getElementById('phone').value.trim();
    if(!name||!phone){ alert('Укажите имя и телефон.'); return; }
    updateSummary();
    const msg = 'Заявка: '+document.getElementById('summary').innerText+`\nКлиент: ${name}\nТелефон: ${phone}`;
    location.href = `https://wa.me/${salon.phone.replace(/[^\\d]/g,'')}?text=${encodeURIComponent(msg)}`;
    setTimeout(()=>alert('Если WhatsApp не открылся, скопируйте сообщение:\n\n'+msg),900);
    return;
  }
  // шаги по кругу
  if(visible==='services') showSection('masters');
  else if(visible==='masters') showSection('calendar');
  else if(visible==='calendar') showSection('checkout');
  else if(visible==='contacts') showSection('services');
  else showSection('services');
}

/* ====== INIT ====== */
function init(){
  renderServices(); renderMasters(); renderCal(); renderDaySlots();
  showSection('services');
  // PWA: регистрация sw (не критично, но приятно)
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js').catch(()=>{}); }
}
init();
</script>
</body>
</html>